* Font and coding
#+BEGIN_SRC  emacs-lisp
(setq doom-font (font-spec :family "Input" :size 15)
      doom-variable-pitch-font (font-spec :family "Input" :size 16)
      doom-unicode-font (font-spec :family "all-the-icons"))


(after! unicode-fonts
    (dolist (unicode-block '("Cyrillic" "Cyrillic Supplement"))
        (push "Input" (cadr (assoc unicode-block unicode-fonts-block-font-mapping)))))

;; Принудительная инициализация шрифтов
;; (setq inhibit-compacting-font-caches t)
;; (setq font-use-system-font t)

;; Выключаю иконки :(
(setq doom-modeline-icon nil)       ; Отключить иконки в modeline
(setq +doom-dashboard-icons nil)    ; Убрать иконки в дашборде
#+END_SRC

* Input-method
#+begin_src emacs-lisp
(set-input-method 'russian-computer)
(isearch-toggle-input-method)

;;(map! "s-SPC" #'toggle-input-method)
;;(map! :map evil-ex-search-keymap "s-SPC" #'toggle-input-method)
#+end_src
* Window
#+begin_src emacs-lisp
(map! :n "C-h" #'evil-window-left
      :n "C-j" #'evil-window-down
      :n "C-k" #'evil-window-up
      :n "C-l" #'evil-window-right)

(map! :leader
      "|" #'evil-window-vsplit  ; Создать окно справа (вертикальное разделение)
      :prefix "w"
      "o" #'delete-other-windows)

;; Переключение буферов по Shift+H и Shift+L
(map! :n "H" #'previous-buffer
      :n "L" #'next-buffer)
#+end_src

* Org
** Directories
#+begin_src emacs-lisp
(setq org-directory "~/Yandex.Disk/roam/areas")
(setq org-agenda-files "~/Yandex.Disk/roam/.agenda_files")
(setq org-roam-directory "~/Yandex.Disk/roam/")

(defvar my/org-roam-excluded-tags '("highlights" "linked")
  "List of tags that should exclude a node from Org-roam's database.")

(setq org-roam-db-node-include-function
      (lambda ()
        (let ((tags (org-get-tags)))
          (not (cl-some (lambda (tag) (member tag tags))
                        my/org-roam-excluded-tags)))))
#+end_src

** Bullets
#+begin_src emacs-lisp
(use-package! org-bullets
  :after org
  :config
  (add-hook 'org-mode-hook (lambda () (org-bullets-mode 1))))
#+end_src

** Habits
#+begin_src emacs-lisp
(use-package! org-habit
  :after org
  :config
  (setq org-habit-following-days 7
        org-habit-preceding-days 35
        org-habit-show-habits t
        org-habit-graph-column 80))
#+end_src
** Capture template
#+begin_src emacs-lisp
(after! org
  (setq org-capture-templates
        `(("t" "Task to inbox" entry  (file "inbox.org")
                          ,(concat "* TODO %?\n"
                                          "/Entered on/ %U")
                          :prepend t :kill-buffer t))))
#+end_src
** Custom agenda
;; цели чтения (помечаю тегами)
;; work - для пользы дела
;; life - философия и художка
;; play - эрудиция и интерес

#+begin_src emacs-lisp
(after! org
    (setq org-hide-emphasis-markers t)
    (setq org-todo-keywords
          '((sequence "HINT(h)" "|" "DONE(d!)")))

    (setq org-agenda-span 1)
    (setq org-agenda-start-day "0d")
    (setq org-log-done 'note)
    (setq org-priority-default 65)

    (setq org-sort-agenda-notime-is-late nil)
    (setq org-agenda-tags-todo-honor-ignore-options t)
    (setq org-agenda-todo-ignore-time-comparison-use-seconds t)
    (setq org-agenda-skip-scheduled-if-done t)

    (setq org-agenda-time-grid
        '(nil
        (800 1000 1200 1400 1600 1800 2000)
        "......" "----------------"))

    (setq org-agenda-todo-ignore-timestamp 'future)
    (setq org-agenda-todo-ignore-scheduled 'future)

    (setq org-agenda-custom-commands
        '(("j" "Jedi task list"
            ((tags-todo "TODO=\"TODO\"+PRIORITY=\"A\""
                    ((org-agenda-overriding-header "\nToday")
                    (org-agenda-todo-ignore-scheduled 'all)))
            (agenda "")
            (tags "Closed>=\"<today>\""
                ((org-agenda-overriding-header "Done")))
            (tags-todo "TODO=\"PROJ\""
                ((org-agenda-overriding-header "Projects")))))
            ))
)
#+end_src

** Roam
#+begin_src emacs-lisp
(after! org-roam
    (setq org-roam-dailies-directory "daily/")
    (setq org-roam-dailies-capture-templates
      `(("d" "default" entry
         "* %<%H-%M> %?"
         :if-new
            (file+head "%(concat org-roam-dailies-directory \"/%<%Y-%m-%d>.org\")"
                    "#+title: %<%Y-%m-%d>"))))

    (setq org-roam-completion-everywhere nil)       ;; Отключить везде
    (setq org-roam-completion-system 'none)       ;; Никакого дополнения
)
#+end_src

#+RESULTS:
| d | default | entry | * %<%H-%M> %? | :if-new | (file+head %(concat org-roam-dailies-directory "/%<%Y-%m-%d>.org") #+title: %<%Y-%m-%d> |

** Graph
#+begin_src emacs-lisp
(use-package! websocket
    :after org-roam)

(use-package! org-roam-ui
    :after org-roam ;; or :after org
;;         normally we'd recommend hooking orui after org-roam, but since org-roam does not have
;;         a hookable mode anymore, you're advised to pick something yourself
;;         if you don't care about startup time, use
;;  :hook (after-init . org-roam-ui-mode)
    :config
    (setq org-roam-ui-sync-theme t
          org-roam-ui-follow t
          org-roam-ui-update-on-save t
          org-roam-ui-open-on-start t))
#+end_src
** Crypt
#+begin_src emacs-lisp
(org-crypt-use-before-save-magic)
(setq org-tags-exclude-from-inheritance (quote ("crypt")))
;; GPG key to use for encryption
;; Either the Key ID or set to nil to use symmetric encryption.
(setq org-crypt-key "noblex@yandex-team.ru")
#+end_src
* Clipboard
#+begin_src emacs-lisp
(set-clipboard-coding-system 'utf-8)

(setq interprogram-paste-function 'x-selection-value)
(setq select-enable-clipboard t)
(setq select-enable-primary t)
(setq save-interprogram-paste-before-kill t)

#+end_src
* Mermaid
#+begin_src emacs-lisp
(setq ob-mermaid-cli-path "~/.local/share/pnpm/mmdc")
(use-package! ob-mermaid
  :after org
  :init
  (after! org
    (add-to-list 'org-babel-load-languages '(mermaid . t))))
#+end_src

* IDE
** Neotree
#+begin_src emacs-lisp
(map! :leader
      (:prefix "t"
        :desc "Neotree"
        :n "n" #'neotree-toggle
               ))


#+end_src

** LSP
#+begin_src emacs-lisp
(defun projectile-pyenv-mode-set ()
  "Set pyenv version matching project name."
  (let ((project (projectile-project-name)))
    (if (member project (pyenv-mode-versions))
        (pyenv-mode-set project)
      (pyenv-mode-unset))))

(after! pyenv-mode
  :init
    (add-hook 'projectile-after-switch-project-hook 'projectile-pyenv-mode-set)
)

(after! lsp-pylsp
  (setq lsp-pylsp-plugins-pycode-style-enabled t
        lsp-pylsp-plugins-flake8-enabled t
        lsp-pylsp-plugins-pycode-style-quotes "'"
        lsp-pylsp-plugins-pycode-style-indent-width 4))
#+end_src

** Project and workspaces
#+begin_src emacs-lisp
(after! projectile
(projectile-register-project-type 'make '("Makefile")
                                  :project-file "Makefile"
				  :compile "ya make -r"
				  :test "make test"
				  :run "make run")
)
#+end_src

** Open in arcanum
#+begin_src emacs-lisp
(defun open-in-arcanum ()
  "Open the current buffer file in arcanum"
    (interactive)
    (browse-url (concat
                "https://a.yandex-team.ru"
                (substring (buffer-file-name) (length "/home/noblex") nil)
)))

(map! :leader
      (:prefix "o"
        :desc "Open in arcanum"
        :n "l" #'open-in-arcanum
               ))
#+end_src

** Many lines comments
#+begin_src emacs-lisp
(map! :leader
      (:map python-mode-map
        :prefix "c"
        :desc "Many lines comment"
            "m" #'string-rectangle))
#+end_src

#+RESULTS:
: string-rectangle
** Ejc-sql
#+begin_src emacs-lisp
(after! ejc-sql
  :init
    (setq flycheck-emacs-lisp-load-path 'inherit)
    (setq clomacs-httpd-default-port 8090) ; Use a port other than 8080.
    (add-hook 'ejc-sql-connected-hook
          (lambda ()
            (ejc-set-fetch-size nil)
            (ejc-set-max-rows nil)
            (ejc-set-show-too-many-rows-message nil)
            (ejc-set-column-width-limit nil)))
    (setq ejc-result-table-impl 'orgtbl-mode)
    (setq ejc-org-mode-show-results 't)
)
#+end_src


* Themes
#+begin_src emacs-lisp
(use-package doom-themes
  :ensure t
  :config
  ;; Global settings (defaults)
  (setq doom-themes-enable-bold t    ; if nil, bold is universally disabled
        doom-themes-enable-italic t) ; if nil, italics is universally disabled
;;  (load-theme 'doom-dracula t)

  ;; Enable flashing mode-line on errors
  (doom-themes-visual-bell-config)
  ;; Enable custom neotree theme (nerd-icons must be installed!)
  (doom-themes-neotree-config)
  ;; or for treemacs users
;;  (setq doom-themes-treemacs-theme "doom-atom") ; use "doom-colors" for less minimal icon theme
;;  (doom-themes-treemacs-config)
  ;; Corrects (and improves) org-mode's native fontification.
 ;; (doom-themes-org-config))
#+end_src
